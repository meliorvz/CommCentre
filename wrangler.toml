name = "comms-centre"
main = "src/worker/index.ts"
compatibility_date = "2024-12-18"
compatibility_flags = ["nodejs_compat"]

# =============================================================================
# DURABLE OBJECTS (shared across all environments)
# =============================================================================

[[durable_objects.bindings]]
name = "THREAD_DO"
class_name = "ThreadDO"

[[durable_objects.bindings]]
name = "SCHEDULER_DO"
class_name = "SchedulerDO"

[[durable_objects.bindings]]
name = "CONFIG_DO"
class_name = "ConfigDO"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["ThreadDO", "SchedulerDO", "ConfigDO"]

# =============================================================================
# DEVELOPMENT ENVIRONMENT (default)
# =============================================================================

[[kv_namespaces]]
binding = "KV"
id = "33d3fbab19b040dea42fa3f32fd6d7f6"

[vars]
ENVIRONMENT = "development"
WORKER_BASE_URL = "https://comms-centre.ancient-fire-eaa9.workers.dev"

# Secrets set via: wrangler secret put <NAME>
# DATABASE_URL, JWT_SECRET, TWILIO_*, OPENROUTER_API_KEY
# TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, GMAIL_*, STRIPE_*

pages_build_output_dir = "admin-ui/dist"

# =============================================================================
# PRODUCTION ENVIRONMENT
# Deploy with: wrangler deploy --env production
# =============================================================================

[env.production]
name = "comms-centre-prod"

[env.production.vars]
ENVIRONMENT = "production"
WORKER_BASE_URL = "https://comms-centre-prod.ancient-fire-eaa9.workers.dev"
pages_build_output_dir = "admin-ui/dist"

[[env.production.durable_objects.bindings]]
name = "THREAD_DO"
class_name = "ThreadDO"

[[env.production.durable_objects.bindings]]
name = "SCHEDULER_DO"
class_name = "SchedulerDO"

[[env.production.durable_objects.bindings]]
name = "CONFIG_DO"
class_name = "ConfigDO"

[[env.production.migrations]]
tag = "v1"
new_sqlite_classes = ["ThreadDO", "SchedulerDO", "ConfigDO"]

[[env.production.kv_namespaces]]
binding = "KV"
id = "1871b3f5a44f4a9fa3403ace1f46bbd3"

# Secrets set via: wrangler secret put <NAME> --env production
# Use separate production credentials for all services
