# T-039: Style Learning Feature

| Field | Value |
|-------|-------|
| **Status** | ðŸ”´ BLOCKED |
| **Round** | 3 |
| **Blocked By** | T-029 âœ…, T-030 âœ… |
| **Effort** | 8-10 hours |
| **Assignee** | _____________ |

---

## Background

Learn the company's communication style by analyzing their sent emails and using it to personalize AI responses.

---

## Implementation Flow

1. **Fetch sent emails** via Gmail API
2. **Analyze with LLM** to extract style patterns
3. **Generate style prompt** for AI
4. **Store as company style guide**

```typescript
// POST /api/style/learn
app.post('/api/style/learn', authMiddleware, async (c) => {
    const companyId = c.get('companyId');
    const gmail = await getGmailClient(c.env, companyId);
    
    // Fetch recent sent emails
    const messages = await gmail.users.messages.list({
        userId: 'me',
        labelIds: ['SENT'],
        maxResults: 50,
    });
    
    // Get full message bodies
    const emails = await Promise.all(
        messages.data.messages.map(m => 
            gmail.users.messages.get({ userId: 'me', id: m.id })
        )
    );
    
    // Extract text content
    const emailTexts = emails.map(e => extractBody(e.data));
    
    // Analyze with LLM
    const styleAnalysis = await analyzeStyle(c.env, emailTexts);
    
    // Store as prompt addition
    await db.update(companyProfile)
        .set({ styleGuide: styleAnalysis.stylePrompt })
        .where(eq(companyProfile.companyId, companyId));
    
    return c.json({ 
        traits: styleAnalysis.traits,
        examplePhrases: styleAnalysis.examplePhrases,
    });
});
```

---

## LLM Analysis Prompt

```
Analyze these 50 sent emails and extract the communication style:

1. Tone (formal/casual/friendly)
2. Common greeting patterns
3. Common sign-off patterns  
4. Vocabulary preferences
5. Sentence structure tendencies
6. Unique phrases or expressions

Output a <style_guide> that can be injected into an AI prompt.
```

---

## Acceptance Criteria

- [ ] Fetches sent emails from Gmail
- [ ] Analyzes with LLM
- [ ] Extracts meaningful style traits
- [ ] Stores as reusable prompt
- [ ] Shows learned traits to user

---

## Definition of Done

- [ ] Code reviewed
- [ ] Style analysis tested
- [ ] AI responses reflect learned style
- [ ] PR merged
