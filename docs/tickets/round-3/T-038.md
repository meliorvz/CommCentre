# T-038: Onboarding State Backend

| Field | Value |
|-------|-------|
| **Status** | ðŸ”´ BLOCKED |
| **Round** | 3 |
| **Blocked By** | All P0 Security Tickets |
| **Effort** | 2-3 hours |
| **Assignee** | _____________ |

---

## Background

Backend API for onboarding state persistence.

---

## Implementation

```typescript
// GET /api/onboarding/state
app.get('/api/onboarding/state', authMiddleware, async (c) => {
    const companyId = c.get('companyId');
    
    const [company] = await db.select({ onboardingState: companies.onboardingState })
        .from(companies)
        .where(eq(companies.id, companyId));
    
    return c.json(company.onboardingState || {
        welcome: false,
        profile: false,
        gmail: false,
        subscription: false,
        phone: false,
        telegram: false,
        complete: false,
    });
});

// PATCH /api/onboarding/state
app.patch('/api/onboarding/state', authMiddleware, async (c) => {
    const companyId = c.get('companyId');
    const { step, completed } = await c.req.json();
    
    const [company] = await db.select({ onboardingState: companies.onboardingState })
        .from(companies)
        .where(eq(companies.id, companyId));
    
    const newState = {
        ...(company.onboardingState || {}),
        [step]: completed,
    };
    
    await db.update(companies)
        .set({ onboardingState: newState })
        .where(eq(companies.id, companyId));
    
    return c.json(newState);
});
```

---

## Acceptance Criteria

- [ ] GET returns current state
- [ ] PATCH updates specific step
- [ ] State persisted in companies.onboarding_state
- [ ] Default state for new companies

---

## Definition of Done

- [ ] Code reviewed
- [ ] API tested
- [ ] PR merged
