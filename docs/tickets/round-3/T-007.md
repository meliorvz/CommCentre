# T-007: Migrate Prompt Routes to DB

| Field | Value |
|-------|-------|
| **Status** | ðŸ”´ BLOCKED |
| **Round** | 3 |
| **Blocked By** | T-001 âœ…, T-004 âœ… |
| **Effort** | 4-6 hours |
| **Assignee** | _____________ |

---

## Background

System prompts (AI instructions) are stored in KV. Migrate to `company_prompts` table with version history and publish workflow.

---

## Current State

```typescript
const prompt = await env.KV.get('prompt:business:published');
```

---

## Target State

```typescript
const [prompt] = await db.select()
    .from(companyPrompts)
    .where(and(
        eq(companyPrompts.companyId, companyId),
        eq(companyPrompts.isPublished, true)
    ))
    .orderBy(desc(companyPrompts.version))
    .limit(1);
```

---

## Features to Implement

1. **Version history** - Save new versions, don't overwrite
2. **Publish workflow** - Draft â†’ Publish
3. **Per-company isolation**

---

## Acceptance Criteria

- [ ] GET /api/prompts returns current + versions
- [ ] POST /api/prompts creates new version
- [ ] POST /api/prompts/publish publishes a version
- [ ] ConfigDO loads published prompt
- [ ] Version history preserved

---

## Definition of Done

- [ ] Code reviewed
- [ ] Prompt editor UI works
- [ ] Version history visible
- [ ] PR merged
